# Step 0 — Environment Variable Inventory & Static/Dynamic Split

## Sources Considered
- `.env.dev` (current development environment)
- `local_script/env_backup` (current production environment snapshot)
- `.env.example` (complete variable catalogue)
- `docker-compose.dev.yml` / `docker-compose.prod.yml` (runtime wiring)
- `backend/app/core/config.py` (Pydantic settings definitions)

> 说明：以下列表包含当前为空的变量，这些变量未来仍有可能启用；同时忽略了在 Compose 文件中已经写死的端口常量。

---

## Development Environment (`.env.dev`)

### 静态变量（继续保留在环境文件中）
- **Core application & runtime**: `ENVIRONMENT`, `PROJECT_NAME`, `VERSION`, `BACKEND_PORT`, `FRONTEND_PORT`, `FRONTEND_URL`, `VITE_API_URL`
- **Security & auth tokens**: `SECRET_KEY`, `ACCESS_TOKEN_EXPIRE_MINUTES`, `REFRESH_TOKEN_EXPIRE_DAYS`, `ALGORITHM`
- **Logging & diagnostics**: `DB_ECHO_LOG`, `LOG_LEVEL`, `LOG_JSON`, `LOG_FILE`
- **Database (Postgres)**: `POSTGRES_HOST`, `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB`, `POSTGRES_PORT`
- **Email (SMTP/Gmail)**: `EMAIL_SMTP_SERVER`, `EMAIL_SMTP_PORT`, `EMAIL_USERNAME`, `EMAIL_PASSWORD`, `EMAIL_FROM_EMAIL`, `EMAIL_USE_TLS`
- **Messaging & background jobs**: `RABBITMQ_HOST`, `RABBITMQ_PORT`, `RABBITMQ_USER`, `RABBITMQ_PASSWORD`, `RABBITMQ_VHOST`, `RABBITMQ_PLUGIN_PORT`, `TASKIQ_TIMEZONE`, `TASKIQ_TASK_DEFAULT_RETRY_DELAY`, `TASKIQ_TASK_MAX_RETRIES`, `TASKIQ_TASK_TIME_LIMIT`, `TASKIQ_WORKER_CONCURRENCY`, `TASKIQ_RESULT_EX_TIME`
- **Cache & rate limiting (Redis)**: `REDIS_HOST`, `REDIS_PORT`, `REDIS_PASSWORD`, `REDIS_DB`, `REDIS_URL`
- **External APIs & keys**: `REDDIT_CLIENT_ID`, `REDDIT_CLIENT_SECRET`, `REDDIT_USER_AGENT`, `TWITTER_API_KEY`, `TWITTER_API_SECRET`, `TWITTER_ACCESS_TOKEN`, `TWITTER_ACCESS_TOKEN_SECRET`, `TWITTER_BEARER_TOKEN`, `AI_GEMINI_API_KEY`
- **LLM / embedding stack**: `LLM_BASE_URL`, `LLM_API_KEY`, `HF_TOKEN`, `HF_REPO_ID`, `HF_FILENAME`, `HF_REVISION`, `HF_HUB_ENABLE_HF_TRANSFER`, `EMBEDDING_MODEL`
- **NLP assets**: `SPACY_MODEL_EN`, `SPACY_MODEL_URL`
- **Observability & tooling**: `PGADMIN_PORT`, `PGADMIN_DEFAULT_EMAIL`, `PGADMIN_DEFAULT_PASSWORD`, `PGADMIN_CONFIG_SERVER_MODE`, `PGADMIN_CONFIG_ENHANCED_COOKIE_PROTECTION`, `PGADMIN_CONFIG_WTF_CSRF_ENABLED`, `REDISINSIGHT_PORT`, `REDISINSIGHT_HOST`, `REDISINSIGHT_LOG_LEVEL`

### 动态变量（迁移到 Redis，运行时可调）
- RAG 检索/召回参数：`RAG_TOP_K`, `RAG_MIN_SIM`, `RAG_MMR_LAMBDA`, `RAG_PER_DOC_LIMIT`, `RAG_OVERSAMPLE`, `RAG_MAX_CANDIDATES`, `RAG_SAME_LANG_BONUS`, `RAG_CONTEXT_TOKEN_BUDGET`, `RAG_CONTEXT_MAX_EVIDENCE`, `RAG_CHUNK_TARGET_TOKENS_EN`, `RAG_CHUNK_TARGET_TOKENS_CJK`, `RAG_CHUNK_TARGET_TOKENS_DEFAULT`, `RAG_CHUNK_OVERLAP_RATIO`, `RAG_CODE_CHUNK_MAX_LINES`, `RAG_CODE_CHUNK_OVERLAP_LINES`, `RAG_IVFFLAT_PROBES`

---

## Production Environment (`local_script/env_backup`)

### 静态变量（继续保留在环境文件中）
- **Core application & domain routing**: `ENVIRONMENT`, `PROJECT_NAME`, `VERSION`, `BACKEND_PORT`, `FRONTEND_PORT`, `FRONTEND_URL`, `DOMAIN_MAIN`, `SUBDOMAIN_PORTAINER`, `SUBDOMAIN_PGADMIN`, `SUBDOMAIN_REDIS`
- **Security & auth tokens**: `SECRET_KEY`, `ACCESS_TOKEN_EXPIRE_MINUTES`, `REFRESH_TOKEN_EXPIRE_DAYS`, `ALGORITHM`
- **Logging & diagnostics**: `DB_ECHO_LOG`, `LOG_LEVEL`, `LOG_JSON`, `LOG_FILE`
- **Database (Postgres)**: `POSTGRES_HOST`, `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB`, `POSTGRES_PORT`
- **Email (SMTP/Gmail)**: `EMAIL_SMTP_SERVER`, `EMAIL_SMTP_PORT`, `EMAIL_USERNAME`, `EMAIL_PASSWORD`, `EMAIL_FROM_EMAIL`, `EMAIL_USE_TLS`
- **Caching (Redis)**: `REDIS_HOST`, `REDIS_PORT`, `REDIS_PASSWORD`, `REDIS_DB`
- **Messaging & worker orchestration**: `RABBITMQ_HOST`, `RABBITMQ_PORT`, `RABBITMQ_USER`, `RABBITMQ_PASSWORD`, `RABBITMQ_VHOST`, `RABBITMQ_PLUGIN_PORT`, `TASKIQ_WORKER_CONCURRENCY`
- **OAuth2 Proxy & SSO**: `OAUTH2_PROXY_PROVIDER`, `OAUTH2_PROXY_CLIENT_ID`, `OAUTH2_PROXY_CLIENT_SECRET`, `OAUTH2_PROXY_COOKIE_SECRET`, `OAUTH2_PROXY_REVERSE_PROXY`, `OAUTH2_PROXY_SET_XAUTHREQUEST`, `OAUTH2_PROXY_PASS_ACCESS_TOKEN`, `OAUTH2_PROXY_HTTP_ADDRESS`, `OAUTH2_PROXY_REDIRECT_URL`, `OAUTH2_PROXY_EMAIL_DOMAINS`, `OAUTH2_PROXY_GITHUB_USERS`, `OAUTH2_PROXY_UPSTREAMS`, `OAUTH2_PROXY_COOKIE_EXPIRE`, `OAUTH2_PROXY_COOKIE_REFRESH`, `OAUTH2_PROXY_COOKIE_HTTPONLY`, `OAUTH2_PROXY_COOKIE_CSRF_PER_REQUEST`, `OAUTH2_PROXY_COOKIE_CSRF_EXPIRE`, `OAUTH2_PROXY_COOKIE_DOMAINS`, `OAUTH2_PROXY_WHITELIST_DOMAINS`, `OAUTH2_PROXY_COOKIE_SAMESITE`, `OAUTH2_PROXY_COOKIE_SECURE`, `OAUTH2_PROXY_SKIP_AUTH_ROUTES`
- **Observability & admin tooling**: `PGADMIN_DEFAULT_EMAIL`, `PGADMIN_DEFAULT_PASSWORD`, `PGADMIN_CONFIG_SERVER_MODE`, `PGADMIN_CONFIG_ENHANCED_COOKIE_PROTECTION`, `PGADMIN_CONFIG_WTF_CSRF_ENABLED`
- **External APIs**: `REDDIT_CLIENT_ID`, `REDDIT_CLIENT_SECRET`, `REDDIT_USER_AGENT`
- **LLM / embedding stack**: `LLM_BASE_URL`, `LLM_API_KEY`, `HF_TOKEN`, `HF_REPO_ID`, `HF_FILENAME`, `HF_REVISION`, `HF_HUB_ENABLE_HF_TRANSFER`, `EMBEDDING_MODEL`
- **NLP assets**: `SPACY_MODEL_EN`, `SPACY_MODEL_URL`

### 动态变量（迁移到 Redis，运行时可调）
- 与开发环境一致：`RAG_TOP_K`, `RAG_MIN_SIM`, `RAG_MMR_LAMBDA`, `RAG_PER_DOC_LIMIT`, `RAG_OVERSAMPLE`, `RAG_MAX_CANDIDATES`, `RAG_SAME_LANG_BONUS`, `RAG_CONTEXT_TOKEN_BUDGET`, `RAG_CONTEXT_MAX_EVIDENCE`, `RAG_CHUNK_TARGET_TOKENS_EN`, `RAG_CHUNK_TARGET_TOKENS_CJK`, `RAG_CHUNK_TARGET_TOKENS_DEFAULT`, `RAG_CHUNK_OVERLAP_RATIO`, `RAG_CODE_CHUNK_MAX_LINES`, `RAG_CODE_CHUNK_OVERLAP_LINES`, `RAG_IVFFLAT_PROBES`

---

## 模板中存在但当前未在生产落地的变量
- **RedisInsight**：`REDISINSIGHT_PORT`, `REDISINSIGHT_HOST`, `REDISINSIGHT_LOG_LEVEL`, `REDISINSIGHT_VERSION`, `REDISINSIGHT_CONTAINER_NAME`
- **TaskIQ 细粒度配置**：`TASKIQ_TIMEZONE`, `TASKIQ_TASK_DEFAULT_RETRY_DELAY`, `TASKIQ_TASK_MAX_RETRIES`, `TASKIQ_TASK_TIME_LIMIT`, `TASKIQ_RESULT_EX_TIME`
- **前端构建 URL**：`VITE_API_URL`
- **推特 / Gemini**：`TWITTER_API_KEY`, `TWITTER_API_SECRET`, `TWITTER_ACCESS_TOKEN`, `TWITTER_ACCESS_TOKEN_SECRET`, `TWITTER_BEARER_TOKEN`, `AI_GEMINI_API_KEY`
- **OAuth2 Proxy 模板字段**：所有 `OAUTH2_PROXY_*` 变量已在生产或模板中定义，额外注意 `OAUTH2_PROXY_GITHUB_USERS` 只在生产快照中出现。

这些字段在 `.env.example` 中有占位，若未来启用，需要同步纳入对应环境的静态配置或动态清单。

---

## 其他备注
- Compose 文件中的端口映射在生产环境均为固定值（`80`, `443` 等），无需额外环境变量。
- `REDIS_URL` 目前仅在开发环境使用（可选快捷连接串），生产通过主机/密码/库拆分配置即可。
- 后续阶段将为动态参数创建 Redis 存储，并在 FastAPI 中实现覆盖逻辑；静态变量仍通过 `.env.*` 注入。
